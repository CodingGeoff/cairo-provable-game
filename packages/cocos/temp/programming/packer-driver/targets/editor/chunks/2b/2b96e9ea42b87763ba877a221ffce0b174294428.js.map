{"version":3,"sources":["file:///Users/ruoyan/Desktop/WorkSpace/LegendOfWarcraftHeroes/assets/script/prefab/HolCharacter.ts"],"names":["GetCharacterCoordinatePosition","direction","row","col","type","result","x","y","_decorator","Component","Font","Label","math","Node","Prefab","Sprite","SpriteFrame","UITransform","OnBeTarget","CharacterState","util","HolAnimation","ActionState","HolNumber","CharacterEnum","getCampHurtPercent","ccclass","property","HolCharacter","$holAnimation","state","coordinate","defaultState","$fightMap","holAnimation","initCharacter","create","fightMap","meta","id","animationNode","node","getChildByName","getComponent","initBones","animationScale","AnimationScale","animationDir","AnimationDir","animationType","AnimationType","animationPosition","AnimationPosition","addChild","playAnimation","spriteFrame","bundle","load","CharacterCamp","position","setPosition","z","setScale","Math","abs","scale","AnimationForward","string","lv","updateUi","StateNode","HpNode","EnergyNode","reasonableData","hp","maxHp","energy","maxEnergy","hasDrawBuff","BuffIconNode","removeAllChildren","buff","indexOf","sprite","addComponent","buffIcon","setContentSize","Size","push","dead","action","actionState","actionMethod","BeforeAction","equipment","ordinarySibling","getSiblingIndex","setSiblingIndex","canAction","OnAttack","OnSkill","AfterAction","attack","hurt","targte","targetState","origin","cure","curePercent","hurtPercent","randomRange","pierceRate","pierce","reduceInjury","defence","max","FreeInjuryPercent","critical","block","random","OnBeHurt","isPlayAnimation","hurtPromise","actionAwaitQueue","executeTargetState","OnBeCure","index","allLiveCharacter","splice","allDeadCharacter","awaitPromise","then","active","Promise","res","OnDead","rebirth","onReBirth","addBuff","OnBuff","deleteBuff","OnDeleteFromCharacter","showString","ceil","showNumber","Color","b","character","OnAddToCharacter","num","color","size","holNumberNodePool","resource","getNodePool","numberNode","get","holNumber","frontSize","number","i","inter","setInterval","put","clearInterval","timeScale","str","label","font","fontSize","removeChild","setTimeout","getFriends","all","filter","c","getEnimies"],"mappings":"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","sourcesContent":["import { _decorator, Component, Font, Label, math, Node, Prefab, Sprite, SpriteFrame, UITransform } from 'cc';\nimport { BuffState } from '../game/fight/buff/BuffState';\nimport { OnBeTarget } from '../game/fight/OnBeTarget';\nimport { CharacterState, CharacterStateCreate } from '../game/fight/character/CharacterState';\nimport { util } from '../util/util';\nimport { HolAnimation } from './HolAnimation';\nimport { ActionState } from '../game/fight/ActionState';\nimport { FightMap } from '../scenes/Fight/Canvas/FightMap';\nimport { HolNumber } from './HolNumber';\nimport { CharacterEnum } from '../game/fight/character/CharacterEnum';\nimport { getCampHurtPercent } from '../game/fight/character/CharacterMetaState';\nconst { ccclass, property } = _decorator;\n\n// 获取角色坐标\nexport function GetCharacterCoordinatePosition(\n    direction: \"left\"|\"right\" , \n    row: number , \n    col: number ,\n    type: \"ordinary\"|\"attack\" = \"ordinary\"\n\n): {x: number , y: number} {\n    const result = {x: 0 , y: 0}\n    if ((row >= 1 || row <= 3) && (col >= 1 || col <= 3)) {\n        result.x = (col - 1) * 195 + 170 - (type === \"attack\" ? 120 : 0)\n        result.y = (3 - row) * 160 - 230\n        if (direction === \"left\") result.x *= -1\n    }\n    return result\n}\n\n@ccclass('HolCharacter')\nexport class HolCharacter extends Component {\n\n    // 动画组件\n    private $holAnimation: HolAnimation\n    get holAnimation() { return this.$holAnimation }\n\n    // 角色状态函数\n    state: CharacterState\n\n    // 所处方位\n    direction: \"left\"|\"right\"\n\n    //坐标\n    coordinate: {row: number , col: number}\n\n    // 角色默认状态 攻击 受到攻击以后会回到该状态\n    defaultState: string = \"rest\"\n\n    // 当前战斗场景\n    private $fightMap: FightMap\n\n    /** \n     * 初始化角色\n     * create 是角色创建数据\n     */\n    async initCharacter(create: CharacterStateCreate , direction: \"left\"|\"right\" , coordinate: {row: number , col: number} = {row: 0 , col: 0}, fightMap: FightMap = null) {\n        // 创建角色状态\n        this.state = new CharacterState(create , this)\n        this.direction = direction\n        this.coordinate = coordinate\n        this.$fightMap = fightMap\n        const meta = CharacterEnum[create.id]\n        // 动画设置\n        const animationNode = this.node.getChildByName(\"HolAnimation\")\n        this.$holAnimation = animationNode.getComponent(HolAnimation)\n        await this.$holAnimation.initBones({\n            animationScale: this.state.meta.AnimationScale ,\n            animationDir: this.state.meta.AnimationDir ,\n            animationType: this.state.meta.AnimationType ,\n            animationPosition: this.state.meta.AnimationPosition\n        })\n        this.node.addChild(animationNode)\n        this.$holAnimation.playAnimation(\"rest\")\n        // 阵营渲染\n        this.node.getChildByName(\"Camp\").getComponent(Sprite).spriteFrame = \n            await util.bundle.load(`image/camp_icon/${meta.CharacterCamp}/spriteFrame` , SpriteFrame)\n        // 角色位置\n        const position = GetCharacterCoordinatePosition(\n            this.direction , \n            this.coordinate.row , \n            this.coordinate.col\n        )\n        this.node.setPosition( position.x , position.y , this.node.position.z )\n        // 角色面朝方向\n        if (this.direction === \"left\") \n            this.$holAnimation.node.setScale(\n                Math.abs(this.$holAnimation.node.scale.x) * this.state.meta.AnimationForward ,\n                this.$holAnimation.node.scale.y ,\n                this.$holAnimation.node.scale.z ,\n            )\n        else \n            this.$holAnimation.node.setScale(\n                Math.abs(this.$holAnimation.node.scale.x) * -this.state.meta.AnimationForward ,\n                this.$holAnimation.node.scale.y ,\n                this.$holAnimation.node.scale.z ,\n            )\n        // 等级渲染\n        this.node\n            .getChildByName(\"State\")\n            .getChildByName(\"Lv\")\n            .getComponent(Label).string = \"Lv:\" + create.lv\n        // 状态渲染\n        await this.updateUi()\n    }\n\n    /** \n     * 更新角色UI\n     */\n    async updateUi() {\n        const StateNode = this.node.getChildByName(\"State\")\n        const HpNode = StateNode.getChildByName(\"Hp\")\n        const EnergyNode = StateNode.getChildByName(\"Energy\")\n        // 数据合理化\n        this.state.reasonableData()\n        // 更新生命值\n        HpNode.getChildByName(\"Value\").setScale(\n            this.state.hp / this.state.maxHp ,\n            HpNode.scale.y ,\n            HpNode.scale.z\n        )\n        // 更新能量\n        EnergyNode.getChildByName(\"Value\").setScale(\n            this.state.energy / this.state.maxEnergy ,\n            EnergyNode.scale.y ,\n            EnergyNode.scale.z\n        )\n        // 显示buff\n        const hasDrawBuff: string[] = []\n        const BuffIconNode = StateNode.getChildByName(\"BuffIcon\")\n        BuffIconNode.removeAllChildren()\n        for (const buff of this.state.buff) {\n            if (hasDrawBuff.indexOf(buff.id) !== -1) continue\n            const node = new Node\n            const sprite = node.addComponent(Sprite)\n            sprite.spriteFrame = await util.bundle.load(buff.meta.buffIcon , SpriteFrame)\n            node.getComponent(UITransform).setContentSize(new math.Size(28 , 28))\n            BuffIconNode.addChild(node)\n            hasDrawBuff.push(buff.id)\n        }\n        // 是否死亡\n        if (this.state.hp <= 0) await this.dead()\n    }\n\n    /** \n     * 行动函数\n     */\n    async action() {\n        const actionState = new ActionState()\n        if (this.state.energy >= this.state.maxEnergy) actionState.actionMethod = \"skill\"\n        // 所有行动之前的回调\n        for (const buff of this.state.buff) \n            await buff.BeforeAction(buff , actionState , this.$fightMap)\n        for (const equipment of this.state.equipment) \n            await equipment.BeforeAction(equipment , actionState , this.$fightMap)\n        await this.state.BeforeAction(this.state , actionState , this.$fightMap)\n        // 设置最高绘制顺序\n        const ordinarySibling = this.node.getSiblingIndex()\n        this.node.setSiblingIndex(9999)\n        // 行动\n        if (actionState.actionMethod === \"attack\" && actionState.canAction) {\n            for (const buff of this.state.buff) \n                await buff.OnAttack(buff , actionState , this.$fightMap)\n            for (const equipment of this.state.equipment) \n                await equipment.OnAttack(equipment , actionState , this.$fightMap)\n            await this.state.OnAttack(this.state , actionState , this.$fightMap)\n            this.state.energy += 20\n        } else if (actionState.actionMethod === \"skill\" && actionState.canAction) {\n            for (const buff of this.state.buff) \n                await buff.OnSkill(buff , actionState , this.$fightMap)\n            for (const equipment of this.state.equipment) \n                await equipment.OnSkill(equipment , actionState , this.$fightMap)\n            await this.state.OnSkill(this.state , actionState , this.$fightMap)\n            this.state.energy = 0\n        }\n        // 更新ui\n        await this.updateUi()\n        // 还原绘制顺序\n        this.node.setSiblingIndex(ordinarySibling)\n        // 行动之后的函数\n        for (const buff of this.state.buff) \n            await buff.AfterAction(buff , this.$fightMap)\n        for (const equipment of this.state.equipment) \n            await equipment.AfterAction(equipment , this.$fightMap)\n        await this.state.AfterAction(this.state , this.$fightMap)\n        // 更新ui\n        await this.updateUi()\n    }\n\n    /** \n     * 攻击函数\n     * hurt 造成伤害值\n     * targte 目标\n     */\n    async attack(hurt: number , targte: HolCharacter) {\n        const targetState = new OnBeTarget()\n        targetState.origin = this.state\n        targetState.cure =    0 * this.state.curePercent\n        targetState.hurt = hurt * this.state.hurtPercent * getCampHurtPercent(\n            this.state.meta.CharacterCamp , \n            targte.state.meta.CharacterCamp\n        )\n        targetState.buff = []\n        // 10%数据波动\n        targetState.cure += math.randomRange(-0.1 , 0.1) * targetState.cure\n        targetState.hurt += math.randomRange(-0.1 , 0.1) * targetState.hurt\n        // 护甲穿透生效\n        const pierceRate = 1 - targte.state.pierce / (targte.state.pierce + 1000)\n        const reduceInjury = (targte.state.defence * pierceRate) / (targte.state.defence * pierceRate + 700)\n        targetState.hurt -= targetState.hurt * reduceInjury\n        targetState.hurt = Math.max(targetState.hurt - targte.state.defence * 0.1 , 1)\n        // 免伤\n        targetState.hurt *= 1 - targte.state.FreeInjuryPercent\n        // 暴击概率\n        if (this.state.critical > math.randomRange(0 , 100)) {\n            targetState.critical = true\n            targetState.hurt *= 1.8\n        }\n        // 概率格挡\n        if (targte.state.block > Math.random() * 100) {\n            targetState.block = true\n            targetState.hurt *= 0.5\n        }\n        // 对方所有被伤害回调\n        for (const equipment of targte.state.equipment) \n            await equipment.OnBeHurt(equipment , targetState , this.$fightMap)\n        for (const buff of targte.state.buff)\n            await buff.OnBeHurt(buff , targetState , this.$fightMap)\n        await targte.state.OnBeHurt(targte.state , targetState , this.$fightMap)\n        // 播放对方受到攻击动画\n        if (this.$fightMap.isPlayAnimation && !targetState.block) {\n            const hurtPromise = targte.$holAnimation.playAnimation(\"hurt\" , 1 , targte.defaultState)\n            this.$fightMap.actionAwaitQueue.push(hurtPromise)\n        }\n        targte.state.energy += 10\n        // 结算\n        await targte.executeTargetState(targetState)\n        // 更新ui\n        await this.updateUi()\n        await targte.updateUi()\n    }\n\n    /** \n     * 治疗函数\n     * cure 治疗值\n     * targte 目标\n     */\n    async cure(cure: number , targte: HolCharacter) {\n        const targetState = new OnBeTarget()\n        targetState.origin = this.state\n        targetState.cure = cure * this.state.curePercent\n        targetState.hurt =    0 * this.state.hurtPercent\n        targetState.buff = []\n        // 10%数据波动\n        targetState.cure += math.randomRange(-0.1 , 0.1) * targetState.cure\n        targetState.hurt += math.randomRange(-0.1 , 0.1) * targetState.hurt\n        // 对方所有被治疗回调\n        for (const equipment of targte.state.equipment) \n            await equipment.OnBeCure(equipment , targetState , this.$fightMap)\n        for (const buff of targte.state.buff)\n            await buff.OnBeCure(buff , targetState , this.$fightMap)\n        await targte.state.OnBeCure(targte.state , targetState , this.$fightMap)\n        // 结束\n        await targte.executeTargetState(targetState)\n        // 更新ui\n        await this.updateUi()\n        await targte.updateUi()\n    }\n\n    /** \n     * 死亡函数\n     * 死亡时调用\n     */\n    async dead() {\n        const index = this.$fightMap.allLiveCharacter.indexOf(this)\n        if (index !== -1) this.$fightMap.allLiveCharacter.splice(index , 1)\n        this.$fightMap.allDeadCharacter.push(this)\n        const awaitPromise = this.holAnimation.playAnimation(\"dead\" , 1 , this.defaultState)\n        this.$fightMap.actionAwaitQueue.push(awaitPromise.then(() => {\n            this.node.active = false\n            return new Promise<void>(async (res) => {\n                for (const buff of this.state.buff) \n                    await buff.OnDead(buff , this.$fightMap)\n                for (const equipment of this.state.equipment) \n                    await equipment.OnDead(equipment , this.$fightMap)\n                await this.state.OnDead(this.state , this.$fightMap)\n                res()\n            })\n        }))\n    }\n\n    /** \n     * 重生函数\n     * 调用后角色重生\n     */\n    async rebirth() {\n        const index = this.$fightMap.allDeadCharacter.indexOf(this)\n        if (index !== -1) this.$fightMap.allDeadCharacter.splice(index , 1)\n        this.$fightMap.allLiveCharacter.push(this)\n        const awaitPromise = this.holAnimation.playAnimation(\"rebirth\" , 1 , this.defaultState)\n        this.node.active = true\n        if (this.state.hp <= 0) this.state.hp = 1\n        return new Promise<void>(res => {\n            this.$fightMap.actionAwaitQueue.push(awaitPromise.then(async () => {\n                for (const buff of this.state.buff) \n                    await buff.onReBirth(buff , this.$fightMap)\n                for (const equipment of this.state.equipment) \n                    await equipment.onReBirth(equipment , this.$fightMap)\n                await this.state.onReBirth(this.state , this.$fightMap)\n                res()\n            }))\n        })\n    }\n\n    /** \n     * 添加buff函数\n     * @param origin 施加者\n     * @param buff 对应的buff\n     */\n    async addBuff(origin: HolCharacter , buff: BuffState) {\n        const targetState = new OnBeTarget()\n        targetState.origin = origin.state\n        targetState.buff.push(buff)\n        // 调用所有角色的被设置buff函数\n        await this.state.OnBuff(this.state , targetState , this.$fightMap)\n        // 调用所有装备的被设置buff函数\n        for (const equipment of this.state.equipment) \n            await equipment.OnBuff(equipment , targetState , this.$fightMap)\n        // 调用所有buff的被设置buff函数\n        for (const buff of this.state.buff) await buff.OnBuff(buff , targetState , this.$fightMap)\n        // 最后执行target state\n        await this.executeTargetState(targetState)\n    }\n\n    /** \n     * 删除buff函数\n     * @param buff 对应的buff\n     */\n    async deleteBuff(buff: BuffState) {\n        const index = this.state.buff.indexOf(buff)\n        if (index === -1) return\n        this.state.buff[index].OnDeleteFromCharacter(this.state.buff[index])\n        this.state.buff.splice(index , 1)\n\n        await this.updateUi()\n    }\n\n    /** \n     * 结算on be target对象\n     * @param targetState 结算对象\n     */\n    private async executeTargetState(targetState: OnBeTarget) {\n        // 显示格挡\n        if (targetState.block && this.$fightMap.isPlayAnimation) {\n            await this.showString(\"格挡\")\n            await this.showString(\"-\" + Math.ceil(targetState.hurt))\n        }\n        // 显示数值\n        else if (this.$fightMap.isPlayAnimation && targetState.hurt) {\n            if (targetState.critical) this.showNumber(-targetState.hurt , new math.Color(220 , 70 , 70 , 255) , 40)\n            else this.showNumber(-targetState.hurt , new math.Color(200 , 200 , 200 , 255) , 25)\n        }\n        if (this.$fightMap.isPlayAnimation && targetState.cure)\n            this.showNumber(+targetState.cure , new math.Color(50 , 220 , 50 , 255) , 25)\n        this.state.hp -= targetState.hurt\n        this.state.hp += targetState.cure\n        for (const b of targetState.buff) {\n            b.character = this.state\n            await b.OnAddToCharacter(b)\n            this.state.buff.push(b)\n        }\n    }\n\n    /** \n     * 显示数值\n     * num 为数值\n     * color 是颜色\n     */\n    async showNumber(num: number , color: math.Color , size: number = 28) {\n        const holNumberNodePool = util.resource.getNodePool(\n            await util.bundle.load(\"prefab/HolNumber\" , Prefab)\n        )\n        const numberNode = holNumberNodePool.get()\n        const holNumber = numberNode.getComponent(HolNumber)\n        holNumber.color = color\n        holNumber.frontSize = size\n        holNumber.number = num\n        this.node.addChild(numberNode)\n\n        const ordinarySibling = numberNode.getSiblingIndex()\n        numberNode.setSiblingIndex(9999)\n\n        return new Promise<void>(res => {\n            let i = 0\n            const inter = setInterval(() => {\n                if (++i > 45) {\n                    res()\n                    holNumberNodePool.put(numberNode)\n                    numberNode.setSiblingIndex(ordinarySibling)\n                    numberNode.setPosition(0,0,numberNode.position.z)\n                    return clearInterval(inter)\n                }\n                numberNode.setPosition(\n                    numberNode.position.x ,\n                    numberNode.position.y + 3 ,\n                    numberNode.position.z ,\n                )\n            } , 20 / this.$holAnimation.timeScale)\n        })\n\n    }\n\n    /** \n     * 显示文字\n     * str 是显示文件\n     */\n    async showString(str: string) {\n        if (!this.$fightMap.isPlayAnimation) return\n        const node = new Node\n        const label = node.addComponent(Label)\n        label.font = await util.bundle.load(\"font/font_title\" , Font)\n        label.string = str\n        label.fontSize = 30\n        this.node.addChild(node)\n        let index = 0\n        const inter = setInterval(() => {\n            if (index++ > 45) {\n                clearInterval(inter)\n                this.node.removeChild(node)\n                return\n            }\n            node.setPosition( node.position.x , node.position.y + 2 , node.position.z )\n        } , 20 / this.$holAnimation.timeScale)\n        return new Promise(res => setTimeout(res, 100))\n    }\n\n    /**\n     * 根据一个数组过滤所有队友\n     */\n    getFriends(all: HolCharacter[]): HolCharacter[] {\n        return all.filter(c => c.direction === this.direction)\n    }\n\n    /**\n     * 根据一个数组过滤所有敌人\n     */\n    getEnimies(all: HolCharacter[]): HolCharacter[] {\n        return all.filter(c => c.direction !== this.direction)\n    }\n}\n\n"]}