{"version":3,"sources":["file:///Users/ruoyan/Desktop/WorkSpace/cairo-provable-game/packages/cocos/assets/script/scenes/Hero/Canvas/CharacterDetail/HeroCharacterDetailPorperty.ts"],"names":["levelUpNeedGold","create","Math","ceil","id","CharacterQuality","lv","levelUpNeedSoule","_decorator","AudioSource","Component","find","Label","sp","CharacterState","util","getConfig","HolUserResource","CharacterEnum","ccclass","property","HeroCharacterDetailPorperty","$state","$answerLevelUp","renderProperty","node","getChildByName","getComponent","string","meta","name","maxHp","attack","defence","speed","starNode","children","forEach","n","active","i","star","sundry","formateNumber","showAllProperty","message","pierce","block","critical","FreeInjuryPercent","maxEnergy","introduce","characterLevelUp","config","result","confirm","selectBoxMessage","selectBoxCallback","b","userData","gold","soul","prompt","render","levelUpEffectSkeleton","Skeleton","audioSource","volume","volumeDetail","character","play","setAnimation","setCompleteListener"],"mappings":"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","sourcesContent":["import { _decorator, AudioSource, Component, find, Label, Node, sp } from 'cc';\nimport { CharacterState, CharacterStateCreate } from '../../../../game/fight/character/CharacterState';\nimport { util } from '../../../../util/util';\nimport { getConfig } from '../../../../common/config/config';\nimport { HolUserResource } from '../../../../prefab/HolUserResource';\nimport { CharacterEnum } from '../../../../game/fight/character/CharacterEnum';\nconst { ccclass, property } = _decorator;\n\n// 升级所需金币\nfunction levelUpNeedGold(create: CharacterStateCreate): number {\n    return Math.ceil(\n        CharacterEnum[create.id].CharacterQuality * create.lv * (create.lv / (create.lv + 80) + 1) * 100\n    )\n}\n\n// 升级所需钻石\nfunction levelUpNeedSoule(create: CharacterStateCreate): number {\n    return Math.ceil(\n        CharacterEnum[create.id].CharacterQuality * create.lv * (create.lv / (create.lv + 80) + 1) * 100 * 0.5\n    )\n}\n\n@ccclass('HeroCharacterDetailPorperty')\nexport class HeroCharacterDetailPorperty extends Component {\n\n    // 角色状态\n    private $state: CharacterState\n\n    // 是否询问升级\n    private $answerLevelUp: boolean = true\n\n    // 渲染属性\n    async renderProperty(create: CharacterStateCreate) {\n        this.$state = new CharacterState(create , null)\n        this.node.getChildByName(\"Name\").getComponent(Label).string = \"名称: \" + this.$state.meta.name\n        this.node.getChildByName(\"Lv\").getComponent(Label).string = \"Lv: \" + this.$state.lv\n        this.node.getChildByName(\"Hp\").getChildByName(\"Value\").getComponent(Label).string = Math.ceil(this.$state.maxHp) + ''\n        this.node.getChildByName(\"Attack\").getChildByName(\"Value\").getComponent(Label).string = Math.ceil(this.$state.attack) + ''\n        this.node.getChildByName(\"Defence\").getChildByName(\"Value\").getComponent(Label).string = Math.ceil(this.$state.defence) + ''\n        this.node.getChildByName(\"Speed\").getChildByName(\"Value\").getComponent(Label).string = Math.ceil(this.$state.speed) + ''\n\n        // 渲染星级\n        const starNode = this.node.getChildByName(\"Star\")\n        starNode.children.forEach(n => n.active = false)\n        starNode.children.forEach(n => n.children[0].active = false)\n        for (let i = 0; i < CharacterEnum[create.id].CharacterQuality; i++) \n            starNode.children[i].active = true\n        for (let i = 0; i < create.star; i++) \n            starNode.children[i].children[0].active = true\n\n        // 是否满级\n        if (create.lv >= 100) {\n            this.node.getChildByName(\"LevelUp\").active = false\n        } else {\n            this.node.getChildByName(\"LevelUp\").active = true\n            // 升级所需资源\n            this.node.getChildByName(\"LevelUp\")\n                .getChildByName(\"LevelUpGold\")\n                .getChildByName(\"Value\")\n                .getComponent(Label).string = util.sundry.formateNumber(levelUpNeedGold(create))\n            this.node.getChildByName(\"LevelUp\")\n                .getChildByName(\"LevelUpSoul\")\n                .getChildByName(\"Value\")\n                .getComponent(Label).string = util.sundry.formateNumber(levelUpNeedSoule(create))\n        }\n    }\n\n    // 显示所有的属性\n    async showAllProperty() {\n        let message = ``\n        message += ` 生命值: ${Math.ceil(this.$state.maxHp)}\\n`\n        message += ` 攻击力: ${Math.ceil(this.$state.attack)}\\n`\n        message += ` 防御力: ${Math.ceil(this.$state.defence)}\\n`\n        message += ` 速度值: ${Math.ceil(this.$state.speed)}\\n`\n        message += ` 穿透值: ${Math.ceil(this.$state.pierce)}\\n`\n        message += ` 格挡率: ${Math.ceil(this.$state.block)}%\\n`\n        message += ` 暴击率: ${Math.ceil(this.$state.critical)}%\\n`\n        message += ` 免伤率: ${Math.ceil(this.$state.FreeInjuryPercent * 100)}%\\n`\n        message += ` 最大能量: ${Math.ceil(this.$state.maxEnergy)}\\n`\n        await util.message.introduce({message})\n    }\n\n    // 英雄升级\n    async characterLevelUp() {\n        const config = getConfig()\n        // 是否询问\n        if (this.$answerLevelUp) {\n            const result = await util.message.confirm({\n                message: \"确定要升级吗?\" ,\n                selectBoxMessage: \"不再询问\" ,\n                selectBoxCallback: (b: boolean) => {this.$answerLevelUp = !b}\n            })\n            // 是否确定\n            if (result === false) return\n        }\n        // 资源不足\n        if (\n            config.userData.gold < levelUpNeedGold(this.$state.create) \n            || \n            config.userData.soul < levelUpNeedSoule(this.$state.create)\n        ) return await util.message.prompt({message: \"资源不足\"})\n        // 资源减少\n        config.userData.gold -= levelUpNeedGold(this.$state.create)\n        config.userData.soul -= levelUpNeedSoule(this.$state.create)\n        // 角色等级提升\n        this.$state.create.lv++\n        // 重新渲染\n        await this.renderProperty(this.$state.create)\n        find(\"Canvas/HolUserResource\").getComponent(HolUserResource).render() // 资源渲染\n        const levelUpEffectSkeleton = this.node.getChildByName(\"LevelUp\").getChildByName(\"LevelUpEffect\").getComponent(sp.Skeleton)\n        //播放声音\n        const audioSource = levelUpEffectSkeleton.node.getComponent(AudioSource)\n        audioSource.volume = config.volume * config.volumeDetail.character\n        audioSource.play()\n        // 播放动画\n        levelUpEffectSkeleton.node.active = true\n        levelUpEffectSkeleton.node.children[0]?.getComponent(sp.Skeleton).setAnimation(0 , \"animation\" , false)\n        levelUpEffectSkeleton.setAnimation(0 , \"animation\" , false)\n        levelUpEffectSkeleton.setCompleteListener(() => levelUpEffectSkeleton.node.active = false)\n    }\n}\n\n"]}