{"version":3,"sources":["file:///Users/ruoyan/Desktop/WorkSpace/LegendOfWarcraftHeroes/assets/script/game/fight/character/CharacterState.ts"],"names":["CharacterState","BasicState","CharacterEnum","EquipmentState","constructor","create","component","meta","id","name","lv","star","hp","maxHp","energy","maxEnergy","attack","defence","speed","pierce","curePercent","hurtPercent","FreeInjuryPercent","critical","block","buff","equipment","Energy","HpGrowth","AttackGrowth","DefenceGrowth","SpeedGrowth","PierceGrowth","Critical","Block","forEach","ec","addEquipment","OnCreateState","reasonableData","equipmentState","push","AddPropertyToCharacter"],"mappings":"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","sourcesContent":["import { Component } from \"cc\";\nimport { BasicState } from \"../BasicState\";\nimport { CharacterMetaState } from \"./CharacterMetaState\";\nimport { BuffState } from \"../buff/BuffState\";\nimport { CharacterEnum } from \"./CharacterEnum\";\nimport { EquipmentState, EquipmentStateCreate } from \"../equipment/EquipmentState\";\nimport { HolCharacter } from \"../../../prefab/HolCharacter\";\nimport { util } from \"../../../util/util\";\n\nexport type CharacterStateCreate = {\n    // id\n    id: string\n    // uuid\n    uuid?: number\n    // 等级\n    lv: number\n    // 星级\n    star: number\n    // 拥有装备\n    equipment: EquipmentStateCreate[]\n    // 力量\n    strength?: number\n    // 敏捷\n    agility?: number\n    // 智力\n    intelligence?: number\n}\n\nexport class CharacterState extends BasicState<CharacterMetaState> {\n\n    /**\n     * 所属组件\n     * 一般来说是 HolCharacter 对象\n     */\n    component: HolCharacter\n\n    // 名称\n    name: string\n    // 等级\n    lv: number\n    // 角色星级\n    star: number\n    // 所属create\n    create: CharacterStateCreate\n\n    // 生命值\n    hp: number\n    // 最大生命值\n    maxHp: number\n    // 能量值\n    energy: number\n    // 最大能量值\n    maxEnergy: number\n    // 攻击力\n    attack: number\n    // 防御力\n    defence: number\n    // 速度\n    speed: number\n    // 穿透\n    pierce: number\n    // 治疗效率\n    curePercent: number = 1.0\n    // 伤害率\n    hurtPercent: number = 1.0\n    // 免伤率\n    FreeInjuryPercent: number = 0.0\n    // 暴击\n    critical: number\n    // 格挡\n    block: number = 0\n\n    // 所有buff\n    buff: BuffState[] = []\n    // 所有装备\n    equipment: EquipmentState[] = []\n\n    /** \n     * 构造器\n     * component 是所属组件\n     */\n    constructor(create: CharacterStateCreate , component: HolCharacter) {\n        const meta: CharacterMetaState = CharacterEnum[create.id]\n        super(meta)\n        this.lv = create.lv\n        this.star = create.star\n        this.name = meta.name\n        this.component = component\n        this.create = create\n\n        this.maxEnergy = meta.Energy\n        this.maxHp = create.lv * meta.HpGrowth * ((create.star - 1) * 0.15 + 1) * (create.lv / 80 + 0.8)\n        this.attack = create.lv * meta.AttackGrowth * ((create.star - 1) * 0.15 + 1) * (create.lv / 80 + 0.8)\n        this.defence = create.lv * meta.DefenceGrowth * ((create.star - 1) * 0.15 + 1) * (create.lv / 80 + 0.8)\n        this.speed = create.lv * meta.SpeedGrowth * ((create.star - 1) * 0.15 + 1) * (create.lv / 80 + 0.8)\n        this.pierce = create.lv * meta.PierceGrowth * ((create.star - 1) * 0.15 + 1) * (create.lv / 80 + 0.8)\n        this.critical = meta.Critical\n        this.block = meta.Block\n\n        create.equipment.forEach(ec => this.addEquipment(ec))\n        meta.OnCreateState(this)\n\n        this.hp = this.maxHp\n        this.energy = 20\n    }\n\n    // 合理化数据\n    reasonableData() {\n        if (this.hp > this.maxHp) this.hp = this.maxHp\n        if (this.energy > this.maxEnergy) this.energy = this.maxEnergy\n        if (this.hp < 0) this.hp = 0\n        if (this.energy < 0) this.energy = 0\n    }\n    \n    /** \n     * 添加装备函数\n     * 在构造时调用会将装备所添加的属性加到该对象上\n     */\n    private addEquipment(equipment: EquipmentStateCreate) {\n        const equipmentState = new EquipmentState(equipment , this)\n        this.equipment.push(equipmentState)\n        equipmentState.AddPropertyToCharacter(equipmentState)\n    }\n}"]}