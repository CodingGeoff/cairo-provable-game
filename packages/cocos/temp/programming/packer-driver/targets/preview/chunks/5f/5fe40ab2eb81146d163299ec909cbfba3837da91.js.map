{"version":3,"sources":["file:///Users/ruoyan/Desktop/WorkSpace/LegendOfWarcraftHeroes/assets/script/prefab/HolCharacter.ts"],"names":["GetCharacterCoordinatePosition","direction","row","col","type","result","x","y","_decorator","Component","Font","Label","math","Node","Prefab","Sprite","SpriteFrame","UITransform","OnBeTarget","CharacterState","util","HolAnimation","ActionState","HolNumber","CharacterEnum","getCampHurtPercent","ccclass","property","HolCharacter","$holAnimation","state","coordinate","defaultState","$fightMap","holAnimation","initCharacter","create","fightMap","meta","id","animationNode","node","getChildByName","getComponent","initBones","animationScale","AnimationScale","animationDir","AnimationDir","animationType","AnimationType","animationPosition","AnimationPosition","addChild","playAnimation","spriteFrame","bundle","load","CharacterCamp","position","setPosition","z","setScale","Math","abs","scale","AnimationForward","string","lv","updateUi","StateNode","HpNode","EnergyNode","reasonableData","hp","maxHp","energy","maxEnergy","hasDrawBuff","BuffIconNode","removeAllChildren","buff","indexOf","sprite","addComponent","buffIcon","setContentSize","Size","push","dead","action","actionState","actionMethod","BeforeAction","equipment","ordinarySibling","getSiblingIndex","setSiblingIndex","canAction","OnAttack","OnSkill","AfterAction","attack","hurt","targte","targetState","origin","cure","curePercent","hurtPercent","randomRange","pierceRate","pierce","reduceInjury","defence","max","FreeInjuryPercent","critical","OnBeHurt","isPlayAnimation","block","hurtPromise","actionAwaitQueue","executeTargetState","OnBeCure","index","allLiveCharacter","splice","allDeadCharacter","awaitPromise","then","active","Promise","res","OnDead","rebirth","onReBirth","addBuff","OnBuff","deleteBuff","OnDeleteFromCharacter","showNumber","Color","b","character","OnAddToCharacter","num","color","size","holNumberNodePool","resource","getNodePool","numberNode","get","holNumber","frontSize","number","i","inter","setInterval","put","clearInterval","timeScale","showString","str","label","font","fontSize","removeChild","setTimeout","getFriends","all","filter","c","getEnimies"],"mappings":"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","sourcesContent":["import { _decorator, Component, Font, Label, math, Node, Prefab, Sprite, SpriteFrame, UITransform } from 'cc';\nimport { BuffState } from '../game/fight/buff/BuffState';\nimport { OnBeTarget } from '../game/fight/OnBeTarget';\nimport { CharacterState, CharacterStateCreate } from '../game/fight/character/CharacterState';\nimport { util } from '../util/util';\nimport { HolAnimation } from './HolAnimation';\nimport { ActionState } from '../game/fight/ActionState';\nimport { FightMap } from '../scenes/Fight/Canvas/FightMap';\nimport { HolNumber } from './HolNumber';\nimport { CharacterEnum } from '../game/fight/character/CharacterEnum';\nimport { getCampHurtPercent } from '../game/fight/character/CharacterMetaState';\nconst { ccclass, property } = _decorator;\n\n// 获取角色坐标\nexport function GetCharacterCoordinatePosition(\n    direction: \"left\"|\"right\" , \n    row: number , \n    col: number ,\n    type: \"ordinary\"|\"attack\" = \"ordinary\"\n\n): {x: number , y: number} {\n    const result = {x: 0 , y: 0}\n    if ((row >= 1 || row <= 3) && (col >= 1 || col <= 3)) {\n        result.x = (col - 1) * 195 + 170 - (type === \"attack\" ? 120 : 0)\n        result.y = (3 - row) * 160 - 230\n        if (direction === \"left\") result.x *= -1\n    }\n    return result\n}\n\n@ccclass('HolCharacter')\nexport class HolCharacter extends Component {\n\n    // 动画组件\n    private $holAnimation: HolAnimation\n    get holAnimation() { return this.$holAnimation }\n\n    // 角色状态函数\n    state: CharacterState\n\n    // 所处方位\n    direction: \"left\"|\"right\"\n\n    //坐标\n    coordinate: {row: number , col: number}\n\n    // 角色默认状态 攻击 受到攻击以后会回到该状态\n    defaultState: string = \"rest\"\n\n    // 当前战斗场景\n    private $fightMap: FightMap\n\n    /** \n     * 初始化角色\n     * create 是角色创建数据\n     */\n    async initCharacter(create: CharacterStateCreate , direction: \"left\"|\"right\" , coordinate: {row: number , col: number} = {row: 0 , col: 0}, fightMap: FightMap = null) {\n        // 创建角色状态\n        this.state = new CharacterState(create , this)\n        this.direction = direction\n        this.coordinate = coordinate\n        this.$fightMap = fightMap\n        const meta = CharacterEnum[create.id]\n        // 动画设置\n        const animationNode = this.node.getChildByName(\"HolAnimation\")\n        this.$holAnimation = animationNode.getComponent(HolAnimation)\n        await this.$holAnimation.initBones({\n            animationScale: this.state.meta.AnimationScale ,\n            animationDir: this.state.meta.AnimationDir ,\n            animationType: this.state.meta.AnimationType ,\n            animationPosition: this.state.meta.AnimationPosition\n        })\n        this.node.addChild(animationNode)\n        this.$holAnimation.playAnimation(\"rest\")\n        // 阵营渲染\n        this.node.getChildByName(\"Camp\").getComponent(Sprite).spriteFrame = \n            await util.bundle.load(`image/camp_icon/${meta.CharacterCamp}/spriteFrame` , SpriteFrame)\n        // 角色位置\n        const position = GetCharacterCoordinatePosition(\n            this.direction , \n            this.coordinate.row , \n            this.coordinate.col\n        )\n        this.node.setPosition( position.x , position.y , this.node.position.z )\n        // 角色面朝方向\n        if (this.direction === \"left\") \n            this.$holAnimation.node.setScale(\n                Math.abs(this.$holAnimation.node.scale.x) * this.state.meta.AnimationForward ,\n                this.$holAnimation.node.scale.y ,\n                this.$holAnimation.node.scale.z ,\n            )\n        else \n            this.$holAnimation.node.setScale(\n                Math.abs(this.$holAnimation.node.scale.x) * -this.state.meta.AnimationForward ,\n                this.$holAnimation.node.scale.y ,\n                this.$holAnimation.node.scale.z ,\n            )\n        // 等级渲染\n        this.node\n            .getChildByName(\"State\")\n            .getChildByName(\"Lv\")\n            .getComponent(Label).string = \"Lv:\" + create.lv\n        // 状态渲染\n        await this.updateUi()\n    }\n\n    /** \n     * 更新角色UI\n     */\n    async updateUi() {\n        const StateNode = this.node.getChildByName(\"State\")\n        const HpNode = StateNode.getChildByName(\"Hp\")\n        const EnergyNode = StateNode.getChildByName(\"Energy\")\n        // 数据合理化\n        this.state.reasonableData()\n        // 更新生命值\n        HpNode.getChildByName(\"Value\").setScale(\n            this.state.hp / this.state.maxHp ,\n            HpNode.scale.y ,\n            HpNode.scale.z\n        )\n        // 更新能量\n        EnergyNode.getChildByName(\"Value\").setScale(\n            this.state.energy / this.state.maxEnergy ,\n            EnergyNode.scale.y ,\n            EnergyNode.scale.z\n        )\n        // 显示buff\n        const hasDrawBuff: string[] = []\n        const BuffIconNode = StateNode.getChildByName(\"BuffIcon\")\n        BuffIconNode.removeAllChildren()\n        for (const buff of this.state.buff) {\n            if (hasDrawBuff.indexOf(buff.id) !== -1) continue\n            const node = new Node\n            const sprite = node.addComponent(Sprite)\n            sprite.spriteFrame = await util.bundle.load(buff.meta.buffIcon , SpriteFrame)\n            node.getComponent(UITransform).setContentSize(new math.Size(28 , 28))\n            BuffIconNode.addChild(node)\n            hasDrawBuff.push(buff.id)\n        }\n        // 是否死亡\n        if (this.state.hp <= 0) await this.dead()\n    }\n\n    /** \n     * 行动函数\n     */\n    async action() {\n        const actionState = new ActionState()\n        if (this.state.energy >= this.state.maxEnergy) actionState.actionMethod = \"skill\"\n        // 所有行动之前的回调\n        for (const buff of this.state.buff) \n            await buff.BeforeAction(buff , actionState , this.$fightMap)\n        for (const equipment of this.state.equipment) \n            await equipment.BeforeAction(equipment , actionState , this.$fightMap)\n        await this.state.BeforeAction(this.state , actionState , this.$fightMap)\n        // 设置最高绘制顺序\n        const ordinarySibling = this.node.getSiblingIndex()\n        this.node.setSiblingIndex(9999)\n        // 行动\n        if (actionState.actionMethod === \"attack\" && actionState.canAction) {\n            for (const buff of this.state.buff) \n                await buff.OnAttack(buff , actionState , this.$fightMap)\n            for (const equipment of this.state.equipment) \n                await equipment.OnAttack(equipment , actionState , this.$fightMap)\n            await this.state.OnAttack(this.state , actionState , this.$fightMap)\n            this.state.energy += 20\n        } else if (actionState.actionMethod === \"skill\" && actionState.canAction) {\n            for (const buff of this.state.buff) \n                await buff.OnSkill(buff , actionState , this.$fightMap)\n            for (const equipment of this.state.equipment) \n                await equipment.OnSkill(equipment , actionState , this.$fightMap)\n            await this.state.OnSkill(this.state , actionState , this.$fightMap)\n            this.state.energy = 0\n        }\n        // 更新ui\n        await this.updateUi()\n        // 还原绘制顺序\n        this.node.setSiblingIndex(ordinarySibling)\n        // 行动之后的函数\n        for (const buff of this.state.buff) \n            await buff.AfterAction(buff , this.$fightMap)\n        for (const equipment of this.state.equipment) \n            await equipment.AfterAction(equipment , this.$fightMap)\n        await this.state.AfterAction(this.state , this.$fightMap)\n        // 更新ui\n        await this.updateUi()\n    }\n\n    /** \n     * 攻击函数\n     * hurt 造成伤害值\n     * targte 目标\n     */\n    async attack(hurt: number , targte: HolCharacter) {\n        const targetState = new OnBeTarget()\n        targetState.origin = this.state\n        targetState.cure =    0 * this.state.curePercent\n        targetState.hurt = hurt * this.state.hurtPercent * getCampHurtPercent(\n            this.state.meta.CharacterCamp , \n            targte.state.meta.CharacterCamp\n        )\n        targetState.buff = []\n        // 10%数据波动\n        targetState.cure += math.randomRange(-0.1 , 0.1) * targetState.cure\n        targetState.hurt += math.randomRange(-0.1 , 0.1) * targetState.hurt\n        // 护甲穿透生效\n        const pierceRate = 1 - targte.state.pierce / (targte.state.pierce + 1000)\n        const reduceInjury = (targte.state.defence * pierceRate) / (targte.state.defence * pierceRate + 700)\n        targetState.hurt -= targetState.hurt * reduceInjury\n        targetState.hurt = Math.max(targetState.hurt - targte.state.defence * 0.1 , 1)\n        // 免伤\n        targetState.hurt *= 1 - targte.state.FreeInjuryPercent\n        // 暴击概率\n        if (this.state.critical > math.randomRange(0 , 100)) {\n            targetState.critical = true\n            targetState.hurt *= 1.8\n        }\n        // 概率格挡\n        // if (targte.state.block > Math.random() * 100) {\n        //     targetState.block = true\n        //     targetState.hurt *= 0.5\n        // }\n        // 对方所有被伤害回调\n        for (const equipment of targte.state.equipment) \n            await equipment.OnBeHurt(equipment , targetState , this.$fightMap)\n        for (const buff of targte.state.buff)\n            await buff.OnBeHurt(buff , targetState , this.$fightMap)\n        await targte.state.OnBeHurt(targte.state , targetState , this.$fightMap)\n        // 播放对方受到攻击动画\n        if (this.$fightMap.isPlayAnimation && !targetState.block) {\n            const hurtPromise = targte.$holAnimation.playAnimation(\"hurt\" , 1 , targte.defaultState)\n            this.$fightMap.actionAwaitQueue.push(hurtPromise)\n        }\n        targte.state.energy += 10\n        // 结算\n        await targte.executeTargetState(targetState)\n        // 更新ui\n        await this.updateUi()\n        await targte.updateUi()\n    }\n\n    /** \n     * 治疗函数\n     * cure 治疗值\n     * targte 目标\n     */\n    async cure(cure: number , targte: HolCharacter) {\n        const targetState = new OnBeTarget()\n        targetState.origin = this.state\n        targetState.cure = cure * this.state.curePercent\n        targetState.hurt =    0 * this.state.hurtPercent\n        targetState.buff = []\n        // 10%数据波动\n        targetState.cure += math.randomRange(-0.1 , 0.1) * targetState.cure\n        targetState.hurt += math.randomRange(-0.1 , 0.1) * targetState.hurt\n        // 对方所有被治疗回调\n        for (const equipment of targte.state.equipment) \n            await equipment.OnBeCure(equipment , targetState , this.$fightMap)\n        for (const buff of targte.state.buff)\n            await buff.OnBeCure(buff , targetState , this.$fightMap)\n        await targte.state.OnBeCure(targte.state , targetState , this.$fightMap)\n        // 结束\n        await targte.executeTargetState(targetState)\n        // 更新ui\n        await this.updateUi()\n        await targte.updateUi()\n    }\n\n    /** \n     * 死亡函数\n     * 死亡时调用\n     */\n    async dead() {\n        const index = this.$fightMap.allLiveCharacter.indexOf(this)\n        if (index !== -1) this.$fightMap.allLiveCharacter.splice(index , 1)\n        this.$fightMap.allDeadCharacter.push(this)\n        const awaitPromise = this.holAnimation.playAnimation(\"dead\" , 1 , this.defaultState)\n        this.$fightMap.actionAwaitQueue.push(awaitPromise.then(() => {\n            this.node.active = false\n            return new Promise<void>(async (res) => {\n                for (const buff of this.state.buff) \n                    await buff.OnDead(buff , this.$fightMap)\n                for (const equipment of this.state.equipment) \n                    await equipment.OnDead(equipment , this.$fightMap)\n                await this.state.OnDead(this.state , this.$fightMap)\n                res()\n            })\n        }))\n    }\n\n    /** \n     * 重生函数\n     * 调用后角色重生\n     */\n    async rebirth() {\n        const index = this.$fightMap.allDeadCharacter.indexOf(this)\n        if (index !== -1) this.$fightMap.allDeadCharacter.splice(index , 1)\n        this.$fightMap.allLiveCharacter.push(this)\n        const awaitPromise = this.holAnimation.playAnimation(\"rebirth\" , 1 , this.defaultState)\n        this.node.active = true\n        if (this.state.hp <= 0) this.state.hp = 1\n        return new Promise<void>(res => {\n            this.$fightMap.actionAwaitQueue.push(awaitPromise.then(async () => {\n                for (const buff of this.state.buff) \n                    await buff.onReBirth(buff , this.$fightMap)\n                for (const equipment of this.state.equipment) \n                    await equipment.onReBirth(equipment , this.$fightMap)\n                await this.state.onReBirth(this.state , this.$fightMap)\n                res()\n            }))\n        })\n    }\n\n    /** \n     * 添加buff函数\n     * @param origin 施加者\n     * @param buff 对应的buff\n     */\n    async addBuff(origin: HolCharacter , buff: BuffState) {\n        const targetState = new OnBeTarget()\n        targetState.origin = origin.state\n        targetState.buff.push(buff)\n        // 调用所有角色的被设置buff函数\n        await this.state.OnBuff(this.state , targetState , this.$fightMap)\n        // 调用所有装备的被设置buff函数\n        for (const equipment of this.state.equipment) \n            await equipment.OnBuff(equipment , targetState , this.$fightMap)\n        // 调用所有buff的被设置buff函数\n        for (const buff of this.state.buff) await buff.OnBuff(buff , targetState , this.$fightMap)\n        // 最后执行target state\n        await this.executeTargetState(targetState)\n    }\n\n    /** \n     * 删除buff函数\n     * @param buff 对应的buff\n     */\n    async deleteBuff(buff: BuffState) {\n        const index = this.state.buff.indexOf(buff)\n        if (index === -1) return\n        this.state.buff[index].OnDeleteFromCharacter(this.state.buff[index])\n        this.state.buff.splice(index , 1)\n\n        await this.updateUi()\n    }\n\n    /** \n     * 结算on be target对象\n     * @param targetState 结算对象\n     */\n    private async executeTargetState(targetState: OnBeTarget) {\n        // 显示格挡\n        if (targetState.block && this.$fightMap.isPlayAnimation) {\n            // await this.showString(\"格挡\")\n            // await this.showString(\"-\" + Math.ceil(targetState.hurt))\n        }\n        // 显示数值\n        else if (this.$fightMap.isPlayAnimation && targetState.hurt) {\n            if (targetState.critical) this.showNumber(-targetState.hurt , new math.Color(220 , 70 , 70 , 255) , 40)\n            else this.showNumber(-targetState.hurt , new math.Color(200 , 200 , 200 , 255) , 25)\n        }\n        if (this.$fightMap.isPlayAnimation && targetState.cure)\n            this.showNumber(+targetState.cure , new math.Color(50 , 220 , 50 , 255) , 25)\n        this.state.hp -= targetState.hurt\n        this.state.hp += targetState.cure\n        for (const b of targetState.buff) {\n            b.character = this.state\n            await b.OnAddToCharacter(b)\n            this.state.buff.push(b)\n        }\n    }\n\n    /** \n     * 显示数值\n     * num 为数值\n     * color 是颜色\n     */\n    async showNumber(num: number , color: math.Color , size: number = 28) {\n        const holNumberNodePool = util.resource.getNodePool(\n            await util.bundle.load(\"prefab/HolNumber\" , Prefab)\n        )\n        const numberNode = holNumberNodePool.get()\n        const holNumber = numberNode.getComponent(HolNumber)\n        holNumber.color = color\n        holNumber.frontSize = size\n        holNumber.number = num\n        this.node.addChild(numberNode)\n\n        const ordinarySibling = numberNode.getSiblingIndex()\n        numberNode.setSiblingIndex(9999)\n\n        return new Promise<void>(res => {\n            let i = 0\n            const inter = setInterval(() => {\n                if (++i > 45) {\n                    res()\n                    holNumberNodePool.put(numberNode)\n                    numberNode.setSiblingIndex(ordinarySibling)\n                    numberNode.setPosition(0,0,numberNode.position.z)\n                    return clearInterval(inter)\n                }\n                numberNode.setPosition(\n                    numberNode.position.x ,\n                    numberNode.position.y + 3 ,\n                    numberNode.position.z ,\n                )\n            } , 20 / this.$holAnimation.timeScale)\n        })\n\n    }\n\n    /** \n     * 显示文字\n     * str 是显示文件\n     */\n    async showString(str: string) {\n        if (!this.$fightMap.isPlayAnimation) return\n        const node = new Node\n        const label = node.addComponent(Label)\n        label.font = await util.bundle.load(\"font/font_title\" , Font)\n        label.string = str\n        label.fontSize = 30\n        this.node.addChild(node)\n        let index = 0\n        const inter = setInterval(() => {\n            if (index++ > 45) {\n                clearInterval(inter)\n                this.node.removeChild(node)\n                return\n            }\n            node.setPosition( node.position.x , node.position.y + 2 , node.position.z )\n        } , 20 / this.$holAnimation.timeScale)\n        return new Promise(res => setTimeout(res, 100))\n    }\n\n    /**\n     * 根据一个数组过滤所有队友\n     */\n    getFriends(all: HolCharacter[]): HolCharacter[] {\n        return all.filter(c => c.direction === this.direction)\n    }\n\n    /**\n     * 根据一个数组过滤所有敌人\n     */\n    getEnimies(all: HolCharacter[]): HolCharacter[] {\n        return all.filter(c => c.direction !== this.direction)\n    }\n}\n\n"]}