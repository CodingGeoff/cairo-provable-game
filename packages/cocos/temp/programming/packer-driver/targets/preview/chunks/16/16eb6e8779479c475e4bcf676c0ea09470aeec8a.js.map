{"version":3,"sources":["file:///Users/ruoyan/Desktop/WorkSpace/LegendOfWarcraftHeroes/assets/script/game/fight/character/CharacterMetaState.ts"],"names":["CharacterMetaState","getCampHurtPercent","self","targte","resources","BasicMetaState","GetCharacterCoordinatePosition","util","AnimationDir","AnimationScale","AnimationPosition","x","y","AnimationForward","AnimationType","AnimationBundle","AvatarPath","CharacterCamp","CharacterQuality","Energy","HpGrowth","AttackGrowth","DefenceGrowth","SpeedGrowth","PierceGrowth","Block","Critical","AttackIntroduce","PassiveIntroduceOne","PassiveIntroduceTwo","SkillIntroduce","GetOnAttack","actionState","fightMap","enemies","component","getEnimies","allLiveCharacter","length","sort","a","b","coordinate","col","targets","push","state","isPlayAnimation","sundry","moveNodeToPosition","node","targetPosition","direction","row","moveCurve","moveTimeScale","holAnimation","timeScale","playAnimation","defaultState","attack"],"mappings":";;;gJAoBaA,kB;;;;;;AAVb;AACO,WAASC,kBAAT,CAA4BC,IAA5B,EAA6CC,MAA7C,EAAuE;AAC1E,QAAID,IAAI,KAAK,UAAT,IAAuBC,MAAM,KAAK,UAAtC,EAAkD,OAAO,GAAP;AAElD,QAAID,IAAI,KAAK,SAAT,IAAsBC,MAAM,KAAK,QAArC,EAA+C,OAAO,GAAP;AAC/C,QAAID,IAAI,KAAK,QAAT,IAAqBC,MAAM,KAAK,SAApC,EAA+C,OAAO,GAAP;AAE/C,WAAO,GAAP;AACH;;;;;;;;;;;;;;;;;;;;;;;;;;;wBAPeF,kB;;;;;;;;;;;AAXcG,MAAAA,S,OAAAA,S;;AACrBC,MAAAA,c,iBAAAA,c;;AAEAC,MAAAA,8B,iBAAAA,8B;;AACAC,MAAAA,I,iBAAAA,I;;;;;;;;;oCAgBIP,kB,GAAN,MAAMA,kBAAN;AAAA;AAAA,4CAAgD;AAAA;AAAA;AAEnD;AAFmD,eAGnDQ,YAHmD;AAKnD;AALmD,eAMnDC,cANmD,GAM1B,GAN0B;AAQnD;AARmD,eASnDC,iBATmD,GASN;AAACC,YAAAA,CAAC,EAAE,CAAJ;AAAQC,YAAAA,CAAC,EAAE;AAAX,WATM;AAWnD;AAXmD,eAYnDC,gBAZmD,GAYxB,CAZwB;AAcnD;AAdmD,eAenDC,aAfmD,GAeT,OAfS;AAiBnD;AAjBmD,eAkBnDC,eAlBmD,GAkBZX,SAlBY;AAoBnD;AApBmD,eAqBnDY,UArBmD;AAuBnD;AAvBmD,eAwBnDC,aAxBmD,GAwBzB,UAxByB;AA0BnD;AA1BmD,eA2BnDC,gBA3BmD,GA2BxB,CA3BwB;AA6BnD;AA7BmD,eA8BnDC,MA9BmD,GA8BlC,GA9BkC;AAgCnD;AAhCmD,eAiCnDC,QAjCmD,GAiChC,CAjCgC;AAmCnD;AAnCmD,eAoCnDC,YApCmD,GAoC5B,CApC4B;AAsCnD;AAtCmD,eAuCnDC,aAvCmD,GAuC3B,CAvC2B;AAyCnD;AAzCmD,eA0CnDC,WA1CmD,GA0C7B,CA1C6B;AA4CnD;AA5CmD,eA6CnDC,YA7CmD,GA6C5B,CA7C4B;AA+CnD;AA/CmD,eAgDnDC,KAhDmD,GAgDnC,CAhDmC;AAkDnD;AAlDmD,eAmDnDC,QAnDmD,GAmDhC,CAnDgC;AAqDnD;AArDmD,eAsDnDC,eAtDmD;AA2DnD;AA3DmD,eA4DnDC,mBA5DmD;AAiEnD;AAjEmD,eAkEnDC,mBAlEmD;AAuEnD;AAvEmD,eAwEnDC,cAxEmD;AAAA;;AA6EnD;AACAC,QAAAA,WAAW,GAAyF;AAChG,gDAAO,WAAO7B,IAAP,EAA6B8B,WAA7B,EAAuDC,QAAvD,EAA8E;AACjF,gBAAIC,OAAO,GAAGhC,IAAI,CAACiC,SAAL,CAAeC,UAAf,CAA0BH,QAAQ,CAACI,gBAAnC,CAAd;AACA,gBAAIH,OAAO,CAACI,MAAR,IAAkB,CAAtB,EAAyB;AACzBJ,YAAAA,OAAO,GAAGA,OAAO,CAACK,IAAR,CAAa,CAACC,CAAD,EAAKC,CAAL,KAAWD,CAAC,CAACE,UAAF,CAAaC,GAAb,GAAmBF,CAAC,CAACC,UAAF,CAAaC,GAAxD,CAAV;AACAX,YAAAA,WAAW,CAACY,OAAZ,CAAoBC,IAApB,CAAyBX,OAAO,CAAC,CAAD,CAAP,CAAWY,KAApC,EAJiF,CAKjF;;AACA,gBAAIb,QAAQ,CAACc,eAAb,EAA8B;AAC1B,oBAAM;AAAA;AAAA,gCAAKC,MAAL,CAAYC,kBAAZ,CACF/C,IAAI,CAACiC,SAAL,CAAee,IADb,EAEF;AACIC,gBAAAA,cAAc,EAAE;AAAA;AAAA,sFACZnB,WAAW,CAACY,OAAZ,CAAoB,CAApB,EAAuBT,SAAvB,CAAiCiB,SADrB,EAEZpB,WAAW,CAACY,OAAZ,CAAoB,CAApB,EAAuBT,SAAvB,CAAiCO,UAAjC,CAA4CW,GAFhC,EAGZrB,WAAW,CAACY,OAAZ,CAAoB,CAApB,EAAuBT,SAAvB,CAAiCO,UAAjC,CAA4CC,GAHhC,EAIZ,QAJY,CADpB;AAOIW,gBAAAA,SAAS,EAAE,IAPf;AAQIC,gBAAAA,aAAa,EAAEvB,WAAW,CAACY,OAAZ,CAAoB,CAApB,EAAuBT,SAAvB,CAAiCqB,YAAjC,CAA8CC;AARjE,eAFE,CAAN;AAaA,oBAAMvD,IAAI,CAACiC,SAAL,CAAeqB,YAAf,CAA4BE,aAA5B,CAA0C,QAA1C,EAAqD,CAArD,EAAyDxD,IAAI,CAACiC,SAAL,CAAewB,YAAxE,CAAN;AACH,aArBgF,CAsBjF;;;AACA,iBAAK,IAAMb,KAAX,IAAoBd,WAAW,CAACY,OAAhC,EACI,MAAM1C,IAAI,CAACiC,SAAL,CAAeyB,MAAf,CAAsB1D,IAAI,CAAC0D,MAAL,GAAc,GAApC,EAA0Cd,KAAK,CAACX,SAAhD,CAAN,CAxB6E,CAyBjF;;;AACA,gBAAIF,QAAQ,CAACc,eAAb,EAA8B;AAC1B,oBAAM;AAAA;AAAA,gCAAKC,MAAL,CAAYC,kBAAZ,CACF/C,IAAI,CAACiC,SAAL,CAAee,IADb,EAEF;AACIC,gBAAAA,cAAc,EAAE;AAAA;AAAA,sFACZjD,IAAI,CAACiC,SAAL,CAAeiB,SADH,EAEZlD,IAAI,CAACiC,SAAL,CAAeO,UAAf,CAA0BW,GAFd,EAGZnD,IAAI,CAACiC,SAAL,CAAeO,UAAf,CAA0BC,GAHd,EAIZ,UAJY,CADpB;AAOIW,gBAAAA,SAAS,EAAE,IAPf;AAQIC,gBAAAA,aAAa,EAAErD,IAAI,CAACiC,SAAL,CAAeqB,YAAf,CAA4BC;AAR/C,eAFE,CAAN;AAaH;;AACD;AACH,WA1CD;AA2CH;;AA1HkD,O","sourcesContent":["import { Asset, AssetManager, resources } from \"cc\";\nimport { BasicMetaState } from \"../BasicMetaState\";\nimport { CharacterState } from \"./CharacterState\";\nimport { GetCharacterCoordinatePosition } from \"../../../prefab/HolCharacter\";\nimport { util } from \"../../../util/util\";\nimport { ActionState } from \"../ActionState\";\nimport { FightMap } from \"../../../scenes/Fight/Canvas/FightMap\";\n\nexport type CampType = \"ordinary\"|\"nature\"|\"abyss\"|\"dark\"|\"machine\"|\"sacred\"\n\n// 获取阵营伤害率\nexport function getCampHurtPercent(self: CampType , targte: CampType): number {\n    if (self === \"ordinary\" || targte === \"ordinary\") return 1.0\n    \n    if (self === \"machine\" && targte === \"nature\") return 1.2\n    if (self === \"nature\" && targte === \"machine\") return 0.8\n\n    return 1.0\n}\n\nexport class CharacterMetaState extends BasicMetaState {\n\n    // 动画所处文件夹\n    AnimationDir: string\n\n    // 动画缩放\n    AnimationScale: number = 1.0\n\n    // 动画位置\n    AnimationPosition: {x: number , y: number} = {x: 0 , y: 0}\n\n    // 动画方向 1 为右边 -1为左边\n    AnimationForward: number = 1\n\n    // 动画类型\n    AnimationType: \"DrangonBones\" | \"Spine\" = \"Spine\"\n\n    // 动画bundle\n    AnimationBundle: AssetManager.Bundle = resources\n\n    // 头像路径\n    AvatarPath: string\n\n    // 角色阵营 普通 自然 深渊\n    CharacterCamp: CampType = \"ordinary\"\n\n    // 角色品质 1 普通 2 优秀 3 精良 4 史诗 5 传说\n    CharacterQuality: number = 1\n\n    // 角色能量条 10 ~ 200\n    Energy: number = 100\n\n    // 角色生命成长属性 30 ~ 100\n    HpGrowth: number = 0\n\n    // 角色攻击成长属性 5 ~ 40\n    AttackGrowth: number = 0\n\n    // 角色防御成长属性 1 ~ 30\n    DefenceGrowth: number = 0\n\n    // 角色速度成长属性 10 ~ 30\n    SpeedGrowth: number = 0\n\n    // 角色穿透 10 ~ 20\n    PierceGrowth: number = 0\n\n    // 格挡原型 1 ~ 100\n    Block: number = 0\n\n    // 暴击原型 1 ~ 100\n    Critical: number = 0\n\n    // 攻击描述\n    AttackIntroduce: string = `普通攻击\n\n    对一个敌人造成攻击力 100% 的伤害\n    `\n\n    // 被动技能一描述\n    PassiveIntroduceOne: string = `技能1\n    \n    无\n    `\n\n    // 被动技能二描述\n    PassiveIntroduceTwo: string = `技能2\n    \n    无\n    `\n\n    // 技能描述\n    SkillIntroduce: string = `普通攻击\n    \n    对一个敌人造成攻击力 130% 的伤害\n    `\n\n    // 默认普通攻击\n    GetOnAttack(): (self: CharacterState, actionState: ActionState, fightMap: FightMap) => Promise<any> {\n        return async (self: CharacterState, actionState: ActionState, fightMap: FightMap) => {\n            let enemies = self.component.getEnimies(fightMap.allLiveCharacter)\n            if (enemies.length <= 0) return\n            enemies = enemies.sort((a , b) => a.coordinate.col - b.coordinate.col)\n            actionState.targets.push(enemies[0].state)\n            // 播放动画\n            if (fightMap.isPlayAnimation) {\n                await util.sundry.moveNodeToPosition(\n                    self.component.node ,\n                    {\n                        targetPosition: GetCharacterCoordinatePosition(\n                            actionState.targets[0].component.direction ,\n                            actionState.targets[0].component.coordinate.row , \n                            actionState.targets[0].component.coordinate.col ,\n                            \"attack\"\n                        ) ,\n                        moveCurve: true ,\n                        moveTimeScale: actionState.targets[0].component.holAnimation.timeScale\n                    }\n                )\n                await self.component.holAnimation.playAnimation(\"attack\" , 1 , self.component.defaultState)\n            }\n            // 结算\n            for (const state of actionState.targets) \n                await self.component.attack(self.attack * 1.0 , state.component)\n            // 播放动画\n            if (fightMap.isPlayAnimation) {\n                await util.sundry.moveNodeToPosition(\n                    self.component.node ,\n                    {\n                        targetPosition: GetCharacterCoordinatePosition(\n                            self.component.direction ,\n                            self.component.coordinate.row , \n                            self.component.coordinate.col ,\n                            \"ordinary\"\n                        ) ,\n                        moveCurve: true ,\n                        moveTimeScale: self.component.holAnimation.timeScale\n                    }\n                )\n            }\n            return\n        }\n    }\n}"]}